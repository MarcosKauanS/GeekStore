<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - Pedidos | GeekStore</title>
  <link rel="stylesheet" href="/css/admin/base.css">
  <link rel="stylesheet" href="/css/admin/order.css">
</head>

<body>
  <aside class="sidebar">
    <div>
      <div class="logo">GeekStore Admin</div>
      <nav>
        <a href="/" class="back-to-site"><span>‚¨ÖÔ∏è</span> Voltar ao Site</a>
        <a th:href="@{/admin/products}">Produtos</a>
        <a th:href="@{/admin/stocks}">Estoque</a>
        <a th:href="@{/admin/users}">Usu√°rios</a>
        <a th:href="@{/admin/orders}" class="active">Pedidos</a>
        <a th:href="@{/admin/categories}">Categorias</a>
      </nav>
    </div>
    <div class="logout" th:onclick="'window.location.href=\'/logout\''">Sair</div>
  </aside>

  <main class="main">
    <h1>Gerenciamento de Pedidos</h1>

    <table>
      <thead>
        <tr>
          <th>Usu√°rio</th>

          <th class="desktop-only">ID</th>

          <th class="desktop-only">Data</th>
          <th class="desktop-only">Total (R$)</th>
          <th class="desktop-only">Status</th>

          <th class="actions-header">A√ß√µes</th>
          <th class="more-column-header">Ver mais</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="order : ${orders}">
          <td th:text="${order.user.name}">Usu√°rio</td>

          <td class="desktop-only" th:text="${order.id}">1</td>

          <td class="desktop-only" th:text="${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')}"></td>
          <td class="desktop-only" th:text="${#numbers.formatDecimal(order.totalAmount, 1, 'POINT', 2, 'COMMA')}"></td>
          <td class="desktop-only">
            <span th:text="${order.status}" th:class="'status ' + ${order.status}"></span>
          </td>

          <td class="actions">
            <a href="#" class="edit" th:attr="data-id=${order.id},data-status=${order.status}">‚úèÔ∏è</a>
            <a th:href="@{'/admin/orders/' + ${order.id}}" class="view-link">üëÅÔ∏è</a>
          </td>

          <td class="more-column">
            <a href="#" class="view" th:attr="data-id=${order.id},
                                    data-user=${order.user.name},
                                    data-date=${#temporals.format(order.orderDate, 'dd/MM/yyyy HH:mm')},
                                    data-total=${#numbers.formatDecimal(order.totalAmount, 1, 'POINT', 2, 'COMMA')},
                                    data-status=${order.status}">
              üëÅÔ∏è Ver mais
            </a>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(orders)}">
          <td colspan="7" class="empty-message">Nenhum pedido encontrado.</td>
        </tr>
      </tbody>
    </table>
  </main>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal">
      <span class="close" id="closeModal">√ó</span>
      <h2>Editar Status do Pedido</h2>
      <form th:action="@{/admin/orders/update-status}" method="post" id="orderForm">
        <input type="hidden" id="orderId" name="id" />
        <label for="status">Status</label>
        <select id="status" name="status" required>
          <option value="PENDING">Pendente</option>
          <option value="PAID">Pago</option>
          <option value="SHIPPED">Enviado</option>
          <option value="DELIVERED">Entregue</option>
          <option value="CANCELLED">Cancelado</option>
        </select>
        <button type="submit" class="btn-save">Salvar</button>
        <button type="button" class="btn-cancel" id="cancelModal">Cancelar</button>
      </form>
    </div>
  </div>

  <div class="modal-overlay" id="viewModalOverlay">
    <div class="modal">
      <span class="close" id="closeViewModal">√ó</span>
      <h2>Detalhes do Pedido</h2>
      <label>ID</label>
      <p id="viewId" class="view-text"></p>
      <label>Usu√°rio</label>
      <p id="viewUser" class="view-text"></p>
      <label>Data</label>
      <p id="viewDate" class="view-text"></p>
      <label>Total</label>
      <p id="viewTotal" class="view-text"></p>
      <label>Status</label>
      <p id="viewStatus" class="view-text"></p>
      <div class="modal-actions">
        <button id="btnViewEdit" class="btn-action edit">‚úèÔ∏è Editar Status</button>
      </div>
      <button type="button" class="btn-cancel" id="closeViewButton" style="margin-top: 15px;">Fechar</button>
    </div>
  </div>

  <script src="/js/admin/modal/common.js"></script>
  <script src="/js/admin/modal/order.js"></script>
</body>

</html>